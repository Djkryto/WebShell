{"ast":null,"code":"import 'ts-replace-all';\nconst initFetch = data => {\n  return {\n    method: 'POST',\n    body: JSON.stringify(data),\n    headers: {\n      'Content-Type': 'application/json'\n    },\n    credentials: 'include'\n  };\n};\n\n/*\r\n* Класс хранящий запросы к серверу.\r\n*/\nclass AuthRepository {\n  constructor() {\n    this.registration = async (data, navigate) => {\n      const urlRegister = 'https://localhost:7145/auth/register';\n      fetch(urlRegister, initFetch(data)).then(() => {\n        navigate('login');\n      });\n    };\n    this.authorization = async (data, tokenContext, navigate) => {\n      const urlLogin = 'https://localhost:7145/auth/login';\n      const isJWT = tokenContext.isJWT;\n      const clientData = {\n        User: data,\n        isJWT: isJWT\n      };\n      const responce = await fetch(urlLogin, initFetch(clientData));\n      responce.text().then(promise => {\n        if (promise === '' && document.cookie === '') return;\n        if (isJWT) tokenContext.setToken(promise);else tokenContext.setToken(document.cookie);\n        navigate('/console');\n      });\n    };\n  }\n}\n/*\r\n * Функция возвращающая экземпляр класса.\r\n */\nexport const instanceAuthRepository = () => new AuthRepository();","map":{"version":3,"names":["initFetch","data","method","body","JSON","stringify","headers","credentials","AuthRepository","registration","navigate","urlRegister","fetch","then","authorization","tokenContext","urlLogin","isJWT","clientData","User","responce","text","promise","document","cookie","setToken","instanceAuthRepository"],"sources":["C:/Project/ASP.Net/TestGit/webshell_front/src/Server/Repository/AuthRepository.tsx"],"sourcesContent":["import { ClientData, User } from '../../Authorization/Component/Login'\r\nimport { Token } from '../../Authorization/AuthorizationProvider'\r\nimport { NavigateFunction } from 'react-router-dom'\r\nimport 'ts-replace-all'\r\n\r\nconst initFetch = (data : User | ClientData): RequestInit  => {\r\n    return {\r\n        method: 'POST',\r\n        body:  JSON.stringify(data),\r\n        headers: {'Content-Type': 'application/json'},\r\n        credentials: 'include'\r\n    }\r\n}\r\n\r\n/*\r\n* Класс хранящий запросы к серверу.\r\n*/\r\nclass AuthRepository {\r\n   /*\r\n    * Регистрация пользователя.\r\n    */\r\n    registration = async (data : User, navigate : NavigateFunction) : Promise<void> => {\r\n        const urlRegister = 'https://localhost:7145/auth/register'\r\n        fetch (urlRegister,initFetch(data))\r\n        .then(()=>{navigate('login')})\r\n    }\r\n   /*\r\n    * Авторизация пользователя с jwt или cookie.\r\n    */\r\n    authorization = async (data : User, tokenContext : Token, navigate : NavigateFunction) : Promise<void> => {\r\n        const urlLogin = 'https://localhost:7145/auth/login'\r\n        const isJWT = tokenContext.isJWT;\r\n        const clientData : ClientData = {User: data, isJWT:isJWT}\r\n        const responce = await fetch (urlLogin,initFetch(clientData))\r\n        responce.text().then(\r\n            (promise : string) : void =>{\r\n                if(promise === '' && document.cookie === '')\r\n                    return\r\n\r\n                if(isJWT)\r\n                    tokenContext.setToken(promise)\r\n                else\r\n                    tokenContext.setToken(document.cookie)\r\n                \r\n                navigate('/console')\r\n            }\r\n        )\r\n    }\r\n}\r\n/*\r\n * Функция возвращающая экземпляр класса.\r\n */\r\nexport const instanceAuthRepository = () : AuthRepository => new AuthRepository()"],"mappings":"AAGA,OAAO,gBAAgB;AAEvB,MAAMA,SAAS,GAAIC,IAAwB,IAAmB;EAC1D,OAAO;IACHC,MAAM,EAAE,MAAM;IACdC,IAAI,EAAGC,IAAI,CAACC,SAAS,CAACJ,IAAI,CAAC;IAC3BK,OAAO,EAAE;MAAC,cAAc,EAAE;IAAkB,CAAC;IAC7CC,WAAW,EAAE;EACjB,CAAC;AACL,CAAC;;AAED;AACA;AACA;AACA,MAAMC,cAAc,CAAC;EAAA;IAAA,KAIjBC,YAAY,GAAG,OAAOR,IAAW,EAAES,QAA2B,KAAqB;MAC/E,MAAMC,WAAW,GAAG,sCAAsC;MAC1DC,KAAK,CAAED,WAAW,EAACX,SAAS,CAACC,IAAI,CAAC,CAAC,CAClCY,IAAI,CAAC,MAAI;QAACH,QAAQ,CAAC,OAAO,CAAC;MAAA,CAAC,CAAC;IAClC,CAAC;IAAA,KAIDI,aAAa,GAAG,OAAOb,IAAW,EAAEc,YAAoB,EAAEL,QAA2B,KAAqB;MACtG,MAAMM,QAAQ,GAAG,mCAAmC;MACpD,MAAMC,KAAK,GAAGF,YAAY,CAACE,KAAK;MAChC,MAAMC,UAAuB,GAAG;QAACC,IAAI,EAAElB,IAAI;QAAEgB,KAAK,EAACA;MAAK,CAAC;MACzD,MAAMG,QAAQ,GAAG,MAAMR,KAAK,CAAEI,QAAQ,EAAChB,SAAS,CAACkB,UAAU,CAAC,CAAC;MAC7DE,QAAQ,CAACC,IAAI,EAAE,CAACR,IAAI,CACfS,OAAgB,IAAW;QACxB,IAAGA,OAAO,KAAK,EAAE,IAAIC,QAAQ,CAACC,MAAM,KAAK,EAAE,EACvC;QAEJ,IAAGP,KAAK,EACJF,YAAY,CAACU,QAAQ,CAACH,OAAO,CAAC,MAE9BP,YAAY,CAACU,QAAQ,CAACF,QAAQ,CAACC,MAAM,CAAC;QAE1Cd,QAAQ,CAAC,UAAU,CAAC;MACxB,CAAC,CACJ;IACL,CAAC;EAAA;AACL;AACA;AACA;AACA;AACA,OAAO,MAAMgB,sBAAsB,GAAG,MAAuB,IAAIlB,cAAc,EAAE"},"metadata":{},"sourceType":"module"}