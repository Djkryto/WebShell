{"ast":null,"code":"import 'ts-replace-all';\nconst initFetch = data => {\n  return {\n    method: 'POST',\n    body: JSON.stringify(data),\n    headers: {\n      'Content-Type': 'application/json'\n    }\n  };\n};\n\n/*\r\n* Класс хранящий запросы к серверу.\r\n*/\nclass AuthRepository {\n  constructor() {\n    this.registration = async (data, navigate) => {\n      const urlRegister = 'https://localhost:7145/auth/register';\n      const responce = await fetch(urlRegister, initFetch(data));\n      const promise = await responce.text();\n      if (promise === '0') navigate('login');\n    };\n    this.authorization = async (data, tokenContext, navigate) => {\n      const urlLogin = 'https://localhost:7145/auth/login';\n      const isJWT = tokenContext.isJWT;\n      const clientData = {\n        User: data,\n        isJWT: isJWT\n      };\n      const responce = await fetch(urlLogin, initFetch(clientData));\n      const promise = await responce.text();\n      if (isJWT) {\n        console.log('Jwt: ' + promise);\n        tokenContext.setToken(promise);\n      } else {\n        console.log('Cookie: ' + promise + '\\n' + 'token ' + document.cookie);\n        tokenContext.setToken(document.cookie);\n      }\n      if (tokenContext.token.length > 10) navigate('/console');\n    };\n  }\n}\n/*\r\n * Функция возвращающая экземпляр класса.\r\n */\nexport const instanceAuthRepository = () => {\n  return new AuthRepository();\n};","map":{"version":3,"names":["initFetch","data","method","body","JSON","stringify","headers","AuthRepository","registration","navigate","urlRegister","responce","fetch","promise","text","authorization","tokenContext","urlLogin","isJWT","clientData","User","console","log","setToken","document","cookie","token","length","instanceAuthRepository"],"sources":["C:/Project/ASP.Net/TestGit/webshell_front/src/Server/Command/AuthRepository.tsx"],"sourcesContent":["import { ClientData, User } from '../../Authorization/Component/Login'\r\nimport { Token } from '../../Authorization/AuthorizationProvider'\r\nimport { NavigateFunction } from 'react-router-dom'\r\nimport 'ts-replace-all'\r\n\r\nconst initFetch = (data : User | ClientData): RequestInit  => {\r\n    return {\r\n        method: 'POST',\r\n        body:  JSON.stringify(data),\r\n        headers: {'Content-Type': 'application/json'}\r\n    }\r\n}\r\n\r\n/*\r\n* Класс хранящий запросы к серверу.\r\n*/\r\nclass AuthRepository {\r\n    /*\r\n    * Регистрация пользователя.\r\n    */\r\n    registration = async (data : User, navigate : NavigateFunction) : Promise<void> => {\r\n        const urlRegister = 'https://localhost:7145/auth/register'\r\n        const responce = await fetch (urlRegister,initFetch(data))\r\n        const promise = await responce.text()\r\n\r\n        if(promise === '0')\r\n            navigate('login')\r\n    }\r\n    /*\r\n    * Авторизация пользователя с токеном.\r\n    */\r\n    authorization = async (data : User, tokenContext : Token, navigate : NavigateFunction) : Promise<void> => {\r\n        const urlLogin = 'https://localhost:7145/auth/login'\r\n        const isJWT = tokenContext.isJWT;\r\n        const clientData : ClientData = {User: data, isJWT:isJWT}\r\n        const responce = await fetch (urlLogin,initFetch(clientData))\r\n        const promise = await responce.text()\r\n\r\n        if(isJWT){\r\n            console.log('Jwt: '+ promise)\r\n            tokenContext.setToken(promise)\r\n        }\r\n        else {\r\n            console.log('Cookie: '+ promise + '\\n'+'token ' + document.cookie)\r\n            tokenContext.setToken(document.cookie)\r\n        }\r\n\r\n        if(tokenContext.token.length > 10)\r\n            navigate('/console')\r\n    }\r\n}\r\n/*\r\n * Функция возвращающая экземпляр класса.\r\n */\r\nexport const instanceAuthRepository = () : AuthRepository => {return new AuthRepository()}"],"mappings":"AAGA,OAAO,gBAAgB;AAEvB,MAAMA,SAAS,GAAIC,IAAwB,IAAmB;EAC1D,OAAO;IACHC,MAAM,EAAE,MAAM;IACdC,IAAI,EAAGC,IAAI,CAACC,SAAS,CAACJ,IAAI,CAAC;IAC3BK,OAAO,EAAE;MAAC,cAAc,EAAE;IAAkB;EAChD,CAAC;AACL,CAAC;;AAED;AACA;AACA;AACA,MAAMC,cAAc,CAAC;EAAA;IAAA,KAIjBC,YAAY,GAAG,OAAOP,IAAW,EAAEQ,QAA2B,KAAqB;MAC/E,MAAMC,WAAW,GAAG,sCAAsC;MAC1D,MAAMC,QAAQ,GAAG,MAAMC,KAAK,CAAEF,WAAW,EAACV,SAAS,CAACC,IAAI,CAAC,CAAC;MAC1D,MAAMY,OAAO,GAAG,MAAMF,QAAQ,CAACG,IAAI,EAAE;MAErC,IAAGD,OAAO,KAAK,GAAG,EACdJ,QAAQ,CAAC,OAAO,CAAC;IACzB,CAAC;IAAA,KAIDM,aAAa,GAAG,OAAOd,IAAW,EAAEe,YAAoB,EAAEP,QAA2B,KAAqB;MACtG,MAAMQ,QAAQ,GAAG,mCAAmC;MACpD,MAAMC,KAAK,GAAGF,YAAY,CAACE,KAAK;MAChC,MAAMC,UAAuB,GAAG;QAACC,IAAI,EAAEnB,IAAI;QAAEiB,KAAK,EAACA;MAAK,CAAC;MACzD,MAAMP,QAAQ,GAAG,MAAMC,KAAK,CAAEK,QAAQ,EAACjB,SAAS,CAACmB,UAAU,CAAC,CAAC;MAC7D,MAAMN,OAAO,GAAG,MAAMF,QAAQ,CAACG,IAAI,EAAE;MAErC,IAAGI,KAAK,EAAC;QACLG,OAAO,CAACC,GAAG,CAAC,OAAO,GAAET,OAAO,CAAC;QAC7BG,YAAY,CAACO,QAAQ,CAACV,OAAO,CAAC;MAClC,CAAC,MACI;QACDQ,OAAO,CAACC,GAAG,CAAC,UAAU,GAAET,OAAO,GAAG,IAAI,GAAC,QAAQ,GAAGW,QAAQ,CAACC,MAAM,CAAC;QAClET,YAAY,CAACO,QAAQ,CAACC,QAAQ,CAACC,MAAM,CAAC;MAC1C;MAEA,IAAGT,YAAY,CAACU,KAAK,CAACC,MAAM,GAAG,EAAE,EAC7BlB,QAAQ,CAAC,UAAU,CAAC;IAC5B,CAAC;EAAA;AACL;AACA;AACA;AACA;AACA,OAAO,MAAMmB,sBAAsB,GAAG,MAAuB;EAAC,OAAO,IAAIrB,cAAc,EAAE;AAAA,CAAC"},"metadata":{},"sourceType":"module"}