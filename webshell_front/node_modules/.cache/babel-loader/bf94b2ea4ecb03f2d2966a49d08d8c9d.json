{"ast":null,"code":"// @ts-nocheck\n\nimport * as signalR from '@microsoft/signalr';\nclass CustomHttpClient extends signalR.DefaultHttpClient {\n  constructor(token) {\n    super();\n    this.token = '';\n    this.token = token;\n  }\n  send(request) {\n    request.headers = {\n      ...request.headers,\n      'cookie': token\n    };\n    console.log(request.headers);\n    return super.send(request);\n  }\n}\n\n/*\r\n* Класс для получения данных с Hub.\r\n*/\nclass Hub {\n  constructor() {\n    this.hub = void 0;\n    this.connectionToHubAsync = async (isJWT, token) => {\n      this.InitHub(isJWT, token);\n      if (this.hub.state === signalR.HubConnectionState.Connected) await this.hub.start();else console.log(\"sd\");\n    };\n    this.InitHub = (isJWT, token) => {\n      if (isJWT) {\n        this.hub = new signalR.HubConnectionBuilder().withUrl('https://localhost:7145/chat', {\n          accessTokenFactory: () => token,\n          skipNegotiation: true,\n          transport: signalR.HttpTransportType.WebSockets\n        }).build();\n      } else {\n        const config = {\n          withCredentials: true,\n          headers: {\n            \"kek\": \"lel\"\n          },\n          skipNegotiation: true,\n          transport: signalR.HttpTransportType.WebSockets\n        };\n        this.hub = new signalR.HubConnectionBuilder().withUrl('https://localhost:7145/chat', config).build();\n      }\n    };\n    this.getDataFromHub = handle => {\n      if (this.hub === null) return;\n      this.hub.on('Send', handle);\n    };\n    this.sendCommand = command => this.hub.invoke('AddCommand', command);\n    this.stopProcessingCommand = () => this.hub.invoke('Stop');\n    this.getConsoleData = () => this.hub.invoke('GetConsoleData');\n  }\n}\nexport const serverHub = new Hub();","map":{"version":3,"names":["signalR","CustomHttpClient","DefaultHttpClient","constructor","token","send","request","headers","console","log","Hub","hub","connectionToHubAsync","isJWT","InitHub","state","HubConnectionState","Connected","start","HubConnectionBuilder","withUrl","accessTokenFactory","skipNegotiation","transport","HttpTransportType","WebSockets","build","config","withCredentials","getDataFromHub","handle","on","sendCommand","command","invoke","stopProcessingCommand","getConsoleData","serverHub"],"sources":["C:/Project/ASP.Net/TestGit/webshell_front/src/Server/WebSoket/Hub.tsx"],"sourcesContent":["// @ts-nocheck\r\nimport { IHistory } from '../../Console/Input/Interface/IHistory'\r\nimport { IDataHub } from '../../Console/Output/Interface/IDataHub'\r\nimport * as signalR from '@microsoft/signalr'\r\nimport { IConsoleData } from '../../Console/Output/Interface/IConsoleData'\r\n\r\n/*\r\n * Обработчик для данных Hub\r\n */\r\ninterface Handler {\r\n    (data : IDataHub): void\r\n}\r\n\r\nclass CustomHttpClient extends signalR.DefaultHttpClient {\r\n    token = ''\r\n    constructor(token : string){\r\n        super()\r\n        this.token = token\r\n    }\r\n    public send(request: HttpRequest): Promise<HttpResponse> {\r\n      request.headers = { ...request.headers, 'cookie': token };\r\n      console.log(request.headers)\r\n      return super.send(request);\r\n    }\r\n}\r\n  \r\n/*\r\n* Класс для получения данных с Hub.\r\n*/\r\nclass Hub {\r\n    hub: signalR.HubConnection\r\n   /*\r\n    * Функция подключения и запуска signalR.\r\n    */\r\n    connectionToHubAsync = async (isJWT:bool,token : string) =>{\r\n        this.InitHub(isJWT,token)\r\n        if(this.hub.state === signalR.HubConnectionState.Connected)\r\n            await this.hub.start()\r\n        else\r\n            console.log(\"sd\")\r\n    }\r\n    /*\r\n    * Функция для получения данных с Hub.\r\n    * @param isJWT выбор поставщика токена.\r\n    * @param token токен доступа.\r\n    */\r\n    InitHub = (isJWT: boolean, token : string) => { \r\n        if(isJWT){\r\n            this.hub = new signalR.HubConnectionBuilder() \r\n            .withUrl('https://localhost:7145/chat', {accessTokenFactory: () => token, skipNegotiation: true, transport: signalR.HttpTransportType.WebSockets})\r\n            .build()\r\n        }\r\n        else{\r\n            const config: IHttpConnectionOptions = {\r\n                withCredentials: true,\r\n                headers: {\"kek\": \"lel\"},\r\n                skipNegotiation: true, \r\n                transport: signalR.HttpTransportType.WebSockets,\r\n            }\r\n            this.hub = new signalR.HubConnectionBuilder() \r\n                .withUrl('https://localhost:7145/chat', config)\r\n                .build()\r\n        }\r\n    }\r\n\r\n   /*\r\n    * Функция для получения данных с Hub.\r\n    * @param handle обработчик данных с hub.\r\n    */\r\n    getDataFromHub = (handle : Handler) =>{\r\n        if(this.hub === null)\r\n            return\r\n\r\n        this.hub.on('Send', handle)\r\n    }\r\n    \r\n   /*\r\n    * Функция для отправки комманды на сервер.\r\n    * @param command команда пользователя.\r\n    */\r\n    sendCommand = (command : string) : Promise<void> => this.hub.invoke('AddCommand',command)\r\n   /*\r\n    * Функция останавливающая выполняюмую команду на сервере ранее введенная пользователем.\r\n    */\r\n    stopProcessingCommand = () : Promise<void> => this.hub.invoke('Stop')\r\n   /*\r\n    * Функция получающая от сервера текущую директорию\r\n    */\r\n    getConsoleData = () : Promise<IConsoleData> => this.hub.invoke('GetConsoleData')\r\n}\r\nexport const serverHub = new Hub()"],"mappings":"AAAA;;AAGA,OAAO,KAAKA,OAAO,MAAM,oBAAoB;AAU7C,MAAMC,gBAAgB,SAASD,OAAO,CAACE,iBAAiB,CAAC;EAErDC,WAAW,CAACC,KAAc,EAAC;IACvB,KAAK,EAAE;IAAA,KAFXA,KAAK,GAAG,EAAE;IAGN,IAAI,CAACA,KAAK,GAAGA,KAAK;EACtB;EACOC,IAAI,CAACC,OAAoB,EAAyB;IACvDA,OAAO,CAACC,OAAO,GAAG;MAAE,GAAGD,OAAO,CAACC,OAAO;MAAE,QAAQ,EAAEH;IAAM,CAAC;IACzDI,OAAO,CAACC,GAAG,CAACH,OAAO,CAACC,OAAO,CAAC;IAC5B,OAAO,KAAK,CAACF,IAAI,CAACC,OAAO,CAAC;EAC5B;AACJ;;AAEA;AACA;AACA;AACA,MAAMI,GAAG,CAAC;EAAA;IAAA,KACNC,GAAG;IAAA,KAIHC,oBAAoB,GAAG,OAAOC,KAAU,EAACT,KAAc,KAAI;MACvD,IAAI,CAACU,OAAO,CAACD,KAAK,EAACT,KAAK,CAAC;MACzB,IAAG,IAAI,CAACO,GAAG,CAACI,KAAK,KAAKf,OAAO,CAACgB,kBAAkB,CAACC,SAAS,EACtD,MAAM,IAAI,CAACN,GAAG,CAACO,KAAK,EAAE,MAEtBV,OAAO,CAACC,GAAG,CAAC,IAAI,CAAC;IACzB,CAAC;IAAA,KAMDK,OAAO,GAAG,CAACD,KAAc,EAAET,KAAc,KAAK;MAC1C,IAAGS,KAAK,EAAC;QACL,IAAI,CAACF,GAAG,GAAG,IAAIX,OAAO,CAACmB,oBAAoB,EAAE,CAC5CC,OAAO,CAAC,6BAA6B,EAAE;UAACC,kBAAkB,EAAE,MAAMjB,KAAK;UAAEkB,eAAe,EAAE,IAAI;UAAEC,SAAS,EAAEvB,OAAO,CAACwB,iBAAiB,CAACC;QAAU,CAAC,CAAC,CACjJC,KAAK,EAAE;MACZ,CAAC,MACG;QACA,MAAMC,MAA8B,GAAG;UACnCC,eAAe,EAAE,IAAI;UACrBrB,OAAO,EAAE;YAAC,KAAK,EAAE;UAAK,CAAC;UACvBe,eAAe,EAAE,IAAI;UACrBC,SAAS,EAAEvB,OAAO,CAACwB,iBAAiB,CAACC;QACzC,CAAC;QACD,IAAI,CAACd,GAAG,GAAG,IAAIX,OAAO,CAACmB,oBAAoB,EAAE,CACxCC,OAAO,CAAC,6BAA6B,EAAEO,MAAM,CAAC,CAC9CD,KAAK,EAAE;MAChB;IACJ,CAAC;IAAA,KAMDG,cAAc,GAAIC,MAAgB,IAAI;MAClC,IAAG,IAAI,CAACnB,GAAG,KAAK,IAAI,EAChB;MAEJ,IAAI,CAACA,GAAG,CAACoB,EAAE,CAAC,MAAM,EAAED,MAAM,CAAC;IAC/B,CAAC;IAAA,KAMDE,WAAW,GAAIC,OAAgB,IAAqB,IAAI,CAACtB,GAAG,CAACuB,MAAM,CAAC,YAAY,EAACD,OAAO,CAAC;IAAA,KAIzFE,qBAAqB,GAAG,MAAsB,IAAI,CAACxB,GAAG,CAACuB,MAAM,CAAC,MAAM,CAAC;IAAA,KAIrEE,cAAc,GAAG,MAA8B,IAAI,CAACzB,GAAG,CAACuB,MAAM,CAAC,gBAAgB,CAAC;EAAA;AACpF;AACA,OAAO,MAAMG,SAAS,GAAG,IAAI3B,GAAG,EAAE"},"metadata":{},"sourceType":"module"}