{"ast":null,"code":"import 'ts-replace-all';\nconst initFetch = data => {\n  return {\n    method: 'POST',\n    body: JSON.stringify(data),\n    headers: {\n      'Content-Type': 'application/json'\n    },\n    credentials: 'include'\n  };\n};\n\n/*\r\n* Класс хранящий запросы к серверу.\r\n*/\nclass AuthRepository {\n  constructor() {\n    this.registration = async (data, navigate) => {\n      const urlRegister = 'https://localhost:7145/auth/register';\n      await fetch(urlRegister, initFetch(data)).then(() => {\n        navigate('login');\n      });\n    };\n    this.authorization = async (data, tokenContext, navigate) => {\n      const urlLogin = 'https://localhost:7145/auth/login';\n      const isJWT = tokenContext.isJWT;\n      const clientData = {\n        User: data,\n        isJWT: isJWT\n      };\n      if (document.cookie === null) console.log('cookie = null');\n      const responce = await fetch(urlLogin, initFetch(clientData));\n      await responce.text().then(promise => {\n        // if(promise === '' & document.cookie === n)\n        //     return\n\n        if (isJWT) {\n          console.log('Jwt: ' + promise);\n          tokenContext.setToken(promise);\n        } else {\n          console.log('Cookie: ' + promise + '\\n' + 'token ' + document.cookie);\n          tokenContext.setToken(document.cookie);\n        }\n        navigate('/console');\n      });\n    };\n  }\n}\n/*\r\n * Функция возвращающая экземпляр класса.\r\n */\nexport const instanceAuthRepository = () => new AuthRepository();","map":{"version":3,"names":["initFetch","data","method","body","JSON","stringify","headers","credentials","AuthRepository","registration","navigate","urlRegister","fetch","then","authorization","tokenContext","urlLogin","isJWT","clientData","User","document","cookie","console","log","responce","text","promise","setToken","instanceAuthRepository"],"sources":["C:/Project/ASP.Net/TestGit/webshell_front/src/Server/Command/AuthRepository.tsx"],"sourcesContent":["import { ClientData, User } from '../../Authorization/Component/Login'\r\nimport { Token } from '../../Authorization/AuthorizationProvider'\r\nimport { NavigateFunction } from 'react-router-dom'\r\nimport 'ts-replace-all'\r\n\r\nconst initFetch = (data : User | ClientData): RequestInit  => {\r\n    return {\r\n        method: 'POST',\r\n        body:  JSON.stringify(data),\r\n        headers: {'Content-Type': 'application/json'},\r\n        credentials: 'include'\r\n    }\r\n}\r\n\r\n/*\r\n* Класс хранящий запросы к серверу.\r\n*/\r\nclass AuthRepository {\r\n   /*\r\n    * Регистрация пользователя.\r\n    */\r\n    registration = async (data : User, navigate : NavigateFunction) : Promise<void> => {\r\n        const urlRegister = 'https://localhost:7145/auth/register'\r\n        await fetch (urlRegister,initFetch(data))\r\n        .then(()=>{navigate('login')})\r\n    }\r\n   /*\r\n    * Авторизация пользователя с jwt или cookie.\r\n    */\r\n    authorization = async (data : User, tokenContext : Token, navigate : NavigateFunction) : Promise<void> => {\r\n        const urlLogin = 'https://localhost:7145/auth/login'\r\n        const isJWT = tokenContext.isJWT;\r\n        const clientData : ClientData = {User: data, isJWT:isJWT}\r\n        if(document.cookie === null)\r\n            console.log('cookie = null')\r\n        const responce = await fetch (urlLogin,initFetch(clientData))\r\n        await responce.text().then(\r\n            (promise : string) =>{\r\n                // if(promise === '' & document.cookie === n)\r\n                //     return\r\n\r\n                if(isJWT){\r\n                    console.log('Jwt: '+ promise)\r\n                    tokenContext.setToken(promise)\r\n                }\r\n                else {\r\n                    console.log('Cookie: '+ promise + '\\n'+'token ' + document.cookie)\r\n                    tokenContext.setToken(document.cookie)\r\n                }\r\n                navigate('/console')\r\n            }\r\n        )\r\n    }\r\n}\r\n/*\r\n * Функция возвращающая экземпляр класса.\r\n */\r\nexport const instanceAuthRepository = () : AuthRepository => new AuthRepository()"],"mappings":"AAGA,OAAO,gBAAgB;AAEvB,MAAMA,SAAS,GAAIC,IAAwB,IAAmB;EAC1D,OAAO;IACHC,MAAM,EAAE,MAAM;IACdC,IAAI,EAAGC,IAAI,CAACC,SAAS,CAACJ,IAAI,CAAC;IAC3BK,OAAO,EAAE;MAAC,cAAc,EAAE;IAAkB,CAAC;IAC7CC,WAAW,EAAE;EACjB,CAAC;AACL,CAAC;;AAED;AACA;AACA;AACA,MAAMC,cAAc,CAAC;EAAA;IAAA,KAIjBC,YAAY,GAAG,OAAOR,IAAW,EAAES,QAA2B,KAAqB;MAC/E,MAAMC,WAAW,GAAG,sCAAsC;MAC1D,MAAMC,KAAK,CAAED,WAAW,EAACX,SAAS,CAACC,IAAI,CAAC,CAAC,CACxCY,IAAI,CAAC,MAAI;QAACH,QAAQ,CAAC,OAAO,CAAC;MAAA,CAAC,CAAC;IAClC,CAAC;IAAA,KAIDI,aAAa,GAAG,OAAOb,IAAW,EAAEc,YAAoB,EAAEL,QAA2B,KAAqB;MACtG,MAAMM,QAAQ,GAAG,mCAAmC;MACpD,MAAMC,KAAK,GAAGF,YAAY,CAACE,KAAK;MAChC,MAAMC,UAAuB,GAAG;QAACC,IAAI,EAAElB,IAAI;QAAEgB,KAAK,EAACA;MAAK,CAAC;MACzD,IAAGG,QAAQ,CAACC,MAAM,KAAK,IAAI,EACvBC,OAAO,CAACC,GAAG,CAAC,eAAe,CAAC;MAChC,MAAMC,QAAQ,GAAG,MAAMZ,KAAK,CAAEI,QAAQ,EAAChB,SAAS,CAACkB,UAAU,CAAC,CAAC;MAC7D,MAAMM,QAAQ,CAACC,IAAI,EAAE,CAACZ,IAAI,CACrBa,OAAgB,IAAI;QACjB;QACA;;QAEA,IAAGT,KAAK,EAAC;UACLK,OAAO,CAACC,GAAG,CAAC,OAAO,GAAEG,OAAO,CAAC;UAC7BX,YAAY,CAACY,QAAQ,CAACD,OAAO,CAAC;QAClC,CAAC,MACI;UACDJ,OAAO,CAACC,GAAG,CAAC,UAAU,GAAEG,OAAO,GAAG,IAAI,GAAC,QAAQ,GAAGN,QAAQ,CAACC,MAAM,CAAC;UAClEN,YAAY,CAACY,QAAQ,CAACP,QAAQ,CAACC,MAAM,CAAC;QAC1C;QACAX,QAAQ,CAAC,UAAU,CAAC;MACxB,CAAC,CACJ;IACL,CAAC;EAAA;AACL;AACA;AACA;AACA;AACA,OAAO,MAAMkB,sBAAsB,GAAG,MAAuB,IAAIpB,cAAc,EAAE"},"metadata":{},"sourceType":"module"}